{{ define "main" }}
<main>
  <article>
    {{- with .Content }}{{ . }}{{ end -}}

    {{- if and (not .IsHome) (.OutputFormats.Get "json") -}}
    {{- $filters := site.Params.project_filters -}}
    {{- $searchEnabled := site.Params.project_search | default false -}}
    {{- $hasFilters := and $filters (gt (len $filters) 0) -}}

    {{/* Filter and Search Controls */}}
    <div id="listControls"
         class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-3"
         data-index-url="{{ .RelPermalink }}index.json"
         data-search-enabled="{{ $searchEnabled }}">

      {{- if $hasFilters -}}
      <div id="filtersContainer" class="d-flex flex-wrap gap-2">
        {{- range $filters -}}
        <div class="filter-group btn-group flex-nowrap"
             data-filter-field="{{ . }}"
             role="group"
             aria-label="Filter by {{ . | title }}">
        </div>
        {{- end -}}
      </div>
      {{- end -}}

      {{- if $searchEnabled -}}
      <div class="input-group" style="max-width: 300px;">
        <span class="input-group-text">
          {{- partial "icons/icon" (dict "vendor" "fas" "name" "magnifying-glass") -}}
        </span>
        <input id="searchInput"
               type="search"
               class="form-control"
               placeholder="Search..."
               aria-label="Search">
      </div>
      {{- end -}}
    </div>

    {{/* Item List Container */}}
    <div id="itemList">
      <div class="text-center text-muted py-4">Loading...</div>
    </div>

    {{/* Card Template */}}
    <template id="cardTemplate">
      <div class="card my-3">
        <div class="card-header">
          <div class="float-end ms-2 mb-1" data-field="badges">
            <a class="badge text-bg-secondary ms-1"
               style="position: relative; z-index: 2;"
               data-field="paper"
               title="View paper"
               target="_blank"
               rel="noopener"
               hidden>
              {{- partial "icons/icon" (dict "vendor" "fas" "name" "file-pdf") -}}
            </a>
            <span class="badge ms-1" data-field="status" hidden></span>
          </div>
          <span class="text-muted fst-italic" data-field="journal" hidden></span>
        </div>
        <div class="card-body">
          {{/* Card Content */}}
          <h5 class="card-title mb-3" data-field="title"></h5>
          <h6 class="card-subtitle mb-2 text-muted" data-field="authors"></h6>
          <p class="card-text" data-field="desc"></p>
        </div>

        {{/* Card Footer */}}
        <div class="card-footer text-muted small">
          <span data-field="date"></span>
          <div class="float-end text-muted">
            <a class="card-link stretched-link text-muted" data-field="link">
              <nobr>Read more â†’</nobr>
            </a>
          </div>
        </div>
      </div>
    </template>

    {{- $listFilter := resources.Get "js/list-filter.js" | minify | fingerprint -}}
    <script src="{{ $listFilter.RelPermalink }}" defer></script>
    {{- end -}}
  </article>
</main>
{{ end }}
