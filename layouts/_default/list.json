{{/*
  JSON index for list pages.
  Used by list-filter.js for client-side filtering and search.
*/}}
{{- $pages := .Pages -}}
{{- if .IsHome -}}
  {{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections -}}
{{- end -}}
[
{{- range $index, $page := $pages -}}
  {{- if $index }},{{ end }}
  {{- /* Parse publication_date (supports "YYYY" or "YYYY-MM" formats) */ -}}
  {{- $pubDateRaw := $page.Params.publication_date | default "" | string -}}
  {{- $pubDateFormatted := "" -}}
  {{- with $pubDateRaw -}}
    {{- $parts := split . "-" -}}
    {{- $year := index $parts 0 -}}
    {{- if and (ge (len $parts) 2) (index $parts 1) -}}
      {{- $monthNum := index $parts 1 -}}
      {{- $monthDate := time (printf "2006-%s-01" $monthNum) -}}
      {{- $pubDateFormatted = printf "%s %s" ($monthDate.Format "January") $year -}}
    {{- else -}}
      {{- $pubDateFormatted = $year -}}
    {{- end -}}
  {{- end -}}
  {
    "title": {{ $page.Title | htmlUnescape | jsonify }},
    "authors": {{ delimit ($page.Params.authors | default slice) ", " | jsonify }},
    "desc": {{ $page.Summary | plainify | htmlUnescape | truncate 200 | jsonify }},
    "content": {{ $page.Plain | htmlUnescape | jsonify }},
    "journal": {{ $page.Params.journal | default "" | jsonify }},
    "publication_date": {{ $pubDateFormatted | jsonify }},
    "status": {{ $page.Params.status | default "" | jsonify }},
    "subject": {{ with $page.Params.subject }}{{ if reflect.IsSlice . }}{{ . | jsonify }}{{ else }}[{{ . | jsonify }}]{{ end }}{{ else }}[]{{ end }},
    "paper_url": {{ $page.Params.paper_url | default "" | jsonify }},
    "section": {{ $page.Section | jsonify }},
    "date": {{ $page.Date.Format "2006-01-02" | jsonify }},
    "date_formatted": {{ $page.Date.Format "Mon, Jan 2, 2006" | jsonify }},
    "permalink": {{ $page.Permalink | jsonify }},
    "relpermalink": {{ $page.RelPermalink | jsonify }}
  }
{{- end -}}
]